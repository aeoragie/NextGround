<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Info"
      internalLogFile="logs/nlog-internal.txt">

	<variable name="logDirectory" value="logs" />

	<targets>
		<!-- 콘솔 타겟 - Microsoft.Hosting.Lifetime 스타일 -->
		<target xsi:type="ColoredConsole"
				name="consoleTarget"
				useDefaultRowHighlightingRules="false"
				layout="${level:lowercase=true}: ${logger}[${event-properties:item=EventId_Id:whenEmpty=0}]${newline}      ${message}${exception:format=tostring}">

			<!-- 로그 레벨별 색상 설정 (Microsoft 스타일) -->
			<highlight-row condition="level == LogLevel.Trace" foregroundColor="DarkGray" />
			<highlight-row condition="level == LogLevel.Debug" foregroundColor="Gray" />
			<highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
			<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
			<highlight-row condition="level == LogLevel.Error" foregroundColor="Red" />
			<highlight-row condition="level == LogLevel.Fatal" foregroundColor="Red" backgroundColor="White" />
		</target>

		<!-- 파일 타겟 - 상세 정보 포함 -->
		<target xsi:type="File"
				name="fileTarget"
				fileName="${var:logDirectory}/playground-${shortdate}.log"
				layout="${longdate} ${level:uppercase=true} ${logger}[${event-properties:item=EventId_Id:whenEmpty=0}] ${message} ${exception:format=tostring}"
				createDirs="true"
				keepFileOpen="false"
				concurrentWrites="true"
				archiveEvery="Day"
				maxArchiveFiles="30"
				encoding="utf-8" />

		<!-- 개발자용 상세 콘솔 (선택사항) -->
		<target xsi:type="ColoredConsole"
				name="detailedConsoleTarget"
				useDefaultRowHighlightingRules="false"
				layout="${time:format=HH\:mm\:ss.fff} ${level:lowercase=true}: ${logger:shortName=true}[${event-properties:item=EventId_Id:whenEmpty=0}]${newline}      ${message}${exception:format=tostring}">
			<highlight-row condition="level == LogLevel.Trace" foregroundColor="DarkGray" />
			<highlight-row condition="level == LogLevel.Debug" foregroundColor="Gray" />
			<highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
			<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
			<highlight-row condition="level == LogLevel.Error" foregroundColor="Red" />
			<highlight-row condition="level == LogLevel.Fatal" foregroundColor="Red" backgroundColor="White" />
		</target>

		<!-- Microsoft.Hosting.Lifetime 전용 타겟 -->
		<target xsi:type="ColoredConsole"
				name="lifetimeTarget"
				useDefaultRowHighlightingRules="false"
				layout="info: ${logger}[${event-properties:item=EventId_Id:whenEmpty=0}]${newline}      ${message}">

			<highlight-row condition="true" foregroundColor="Green" />
		</target>

		<!-- 에러 전용 콘솔 (빨간색) -->
		<target xsi:type="ColoredConsole"
				name="errorConsoleTarget"
				useDefaultRowHighlightingRules="false"
				layout="fail: ${logger}[${event-properties:item=EventId_Id:whenEmpty=0}]${newline}      ${message}${newline}${exception:format=tostring}">

			<highlight-row condition="true" foregroundColor="Red" />
		</target>
	</targets>

	<rules>
		<!-- Microsoft.Hosting.Lifetime은 특별 처리 -->
		<logger name="Microsoft.Hosting.Lifetime" minlevel="Info" writeTo="lifetimeTarget" final="true" />

		<!-- Microsoft 관련 로그 필터링 -->
		<logger name="Microsoft.*" maxlevel="Warning" final="true" />
		<logger name="System.Net.Http.*" maxlevel="Info" final="true" />

		<!-- 에러 레벨은 에러 콘솔로 -->
		<logger name="*" level="Error" writeTo="errorConsoleTarget" />
		<logger name="*" level="Fatal" writeTo="errorConsoleTarget" />

		<!-- 나머지 로그들 -->
		<logger name="*" minlevel="Debug" writeTo="consoleTarget,fileTarget" />
	</rules>
</nlog>

<!-- 
설명:
1. ${level:lowercase=true} - 로그 레벨을 소문자로 (info, warn, error)
2. ${logger} - 로거 이름 (Microsoft.Hosting.Lifetime 등)
3. [${event-properties:item=EventId_Id:whenEmpty=0}] - 이벤트 ID ([0], [14] 등)
4. ${newline}      - 줄바꿈 후 6칸 들여쓰기
5. ${message} - 실제 메시지 내용

출력 예시:
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
-->

<!-- Alternative: 더 간단한 버전 -->
<!-- 
<targets>
  <target xsi:type="ColoredConsole"
          name="simpleConsole"
          layout="${level:lowercase=true}: ${logger:shortName=true}${newline}      ${message}"
          useDefaultRowHighlightingRules="false">
    <highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
    <highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
    <highlight-row condition="level == LogLevel.Error" foregroundColor="Red" />
  </target>
</targets>
-->

<!-- Alternative: EventId 없는 버전 -->
<!--
<target xsi:type="ColoredConsole"
        name="consoleNoEventId"
        layout="${level:lowercase=true}: ${logger}${newline}      ${message}"
        useDefaultRowHighlightingRules="false">
  <highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
</target>
-->

<!-- Alternative: 시간 포함 버전 -->
<!--
<target xsi:type="ColoredConsole"
        name="consoleWithTime"
        layout="${time:format=HH\:mm\:ss} ${level:lowercase=true}: ${logger}[${event-properties:item=EventId_Id:whenEmpty=0}]${newline}      ${message}"
        useDefaultRowHighlightingRules="false">
  <highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
</target>
-->


<!--
layout="${level:lowercase=true}: ${logger}[${event-properties:item=EventId_Id:whenEmpty=0}]${newline}      ${message}${exception:format=tostring}"
-->

<!--
<highlight-row condition="level == LogLevel.Debug" foregroundColor="DarkGray" />
<highlight-row condition="level == LogLevel.Info" foregroundColor="White" />
<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
<highlight-row condition="level == LogLevel.Error" foregroundColor="Red" />
<highlight-row condition="level == LogLevel.Fatal" foregroundColor="Red" backgroundColor="White" />
-->