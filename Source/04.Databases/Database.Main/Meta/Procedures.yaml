# =============================================================
# Database.Main 프로시저 메타데이터
# Generator.Database에서 코드 생성 시 참조
# =============================================================

# 기본 설정
Defaults:
  Schema: dbo
  Generates:
    Entity: true      # Ng.Shared/Persistence/Generated/
    Dto: true         # Ng.Shared/Dtos/Generated/
    Message: false    # Ng.Shared/Contracts/Generated/

Procedures:
  # =============================================================
  # 케이스 1: 테이블 직접 참조 (단일)
  # - NspGetUser가 Users 테이블 컬럼을 직접 SELECT
  # =============================================================
  NspGetUser:
    Schema: nested
    Description: "사용자 정보 조회 (내부용)"
    Returns:
      Type: Single                    # Single  |   List        |   None
      Source: Table                   # Table   |   Procedure   |   Join    |   Custom
      Reference: Users
    Generates:
      Entity: true
      Dto: false                      # Nested는 외부 노출 안함
      Message: false

  # =============================================================
  # 케이스 2: 프로시저 참조 (다른 프로시저 결과 재사용)
  # - UspGetUser가 NspGetUser를 호출하여 결과 반환
  # =============================================================
  UspGetUser:
    Description: "사용자 정보 조회"
    Returns:
      Type: Single
      Source: Procedure               # 다른 프로시저 결과 참조
      Reference: NspGetUser
    Generates:
      Entity: false                   # NspGetUser에서 이미 생성
      Dto: UserDto
      Message: false

  # =============================================================
  # 케이스 3: JOIN 결과 (여러 테이블 조합)
  # - NspGetUserWithSocialAccount가 Users + UserSocialAccounts JOIN
  # =============================================================
  NspGetUserWithSocialAccount:
    Schema: nested
    Description: "소셜 계정 포함 사용자 정보 조회 (내부용)"
    Returns:
      Type: Single
      Source: Join
      References:
        - Table: Users
          Alias: u
          Columns:
            - UserId
            - Email
            - EmailConfirmed
            - FullName
            - NickName
            - ProfileImageUrl
            - UserStatus
            - UserRole
            - CreatedAt
            - UpdatedAt
        - Table: UserSocialAccounts
          Alias: sa
          Columns:
            - SocialAccountId
            - Provider
            - ProviderUserId
    Generates:
      Entity: UserWithSocialAccountEntity
      Dto: false
      Message: false

  # =============================================================
  # 케이스 4: 커스텀 결과 (테이블에 없는 컬럼 조합)
  # - UspCreateRefreshToken이 생성된 TokenId만 반환
  # =============================================================
  UspCreateRefreshToken:
    Description: "리프레시 토큰 생성"
    Returns:
      Type: Single
      Source: custom
      Columns:
        - Name: TokenId
          Type: uniqueidentifier
          Nullable: false
    Generates:
      Entity: false
      Dto: TokenResultDto
      Message: CreateRefreshTokenResponse

  # =============================================================
  # 케이스 5: 리스트 반환
  # - UspGetUserList가 Users 테이블 목록 반환
  # =============================================================
  UspGetUserList:
    Description: "사용자 목록 조회"
    Returns:
      Type: list
      Source: table
      Reference: Users
    Generates:
      Entity: false                   # Users Entity 재사용
      Dto: UserSummaryDto
      Message: false

  # =============================================================
  # 케이스 6: 반환값 없음
  # - UspUpdateLastLogin이 결과 반환 없이 업데이트만 수행
  # =============================================================
  UspUpdateLastLogin:
    Description: "마지막 로그인 정보 업데이트"
    Returns:
      Type: none
    Generates:
      Entity: false
      Dto: false
      Message: false
